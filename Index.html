<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.css" />

    <?!= include('Styles'); ?>
  </head>
  <body>

    <div id="loading" class="loading-overlay">
      <div class="spinner-border text-primary" role="status"></div>
      <p class="mt-2 fw-bold text-secondary" id="loadingText">Carregando...</p>
    </div>

    <div id="telaGeral" class="screen active container-fluid py-3">
      <h5 class="fw-bold mb-3"><i class="fa-solid fa-earth-americas text-primary me-2"></i>Visão Geral</h5>
      <div class="row g-2 mb-3">
        <div class="col-6">
          <div class="p-3 bg-white border rounded shadow-sm text-center">
            <h3 class="fw-bold text-primary m-0" id="totalQuadrasGeral">-</h3>
            <small class="text-muted">Quadras</small>
          </div>
        </div>
        <div class="col-6">
          <div class="p-3 bg-white border rounded shadow-sm text-center">
            <h3 class="fw-bold text-success m-0" id="totalDomiciliosGeral">-</h3>
            <small class="text-muted">Domicílios</small>
          </div>
        </div>
      </div>
      <div class="map-wrapper"><div id="mapGeral"></div></div>
    </div>

    <div id="telaPoligonos" class="screen container-fluid py-3">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="fw-bold m-0"><i class="fa-solid fa-pen-to-square text-info me-2"></i>Editor de Malha</h5>
        <button class="btn btn-sm btn-outline-secondary" onclick="iniciarMapaPoligonos()">Recarregar</button>
      </div>
      <p class="text-muted small">Clique em uma quadra para editar.</p>
      <div class="map-wrapper"><div id="mapPoligonos"></div></div>
    </div>

    <div id="telaDetalhe" class="screen container-fluid py-3">
      <div class="d-flex gap-2 mb-3 no-print">
        <select id="selectQuadra" class="form-select shadow-sm" onchange="carregarQuadra(this.value)">
          <option value="" selected disabled>Selecione...</option>
        </select>
        <button class="btn btn-outline-secondary" onclick="window.print()"><i class="fa-solid fa-print"></i></button>
      </div>
      <div id="infoArea" style="display:none;">
        <h4 id="tituloQuadra" class="fw-bold text-dark mb-1"></h4>
        <p class="text-muted small mb-3"><span id="totalEnderecos">0</span> Endereços • <span id="totalUnidades">0</span> Domicílios</p>
        <div id="mapDetalhe"></div>
        <div class="accordion pb-5" id="listaEnderecos"></div>
      </div>
    </div>

    <div class="modal fade" id="modalEdicao" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Editar Quadra</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form>
              <input type="hidden" id="editOriginalId">
              <div class="mb-3"><label class="form-label">Nome (ID)</label><input type="text" class="form-control" id="editId"></div>
              <div class="mb-3"><label class="form-label">Território</label><input type="text" class="form-control" id="editTerritory"></div>
              <div class="mb-3"><label class="form-label">Cor</label><input type="color" class="form-control w-100" id="editColor"></div>
              <div class="d-grid gap-2">
                <button type="button" class="btn btn-outline-primary" id="btnToggleVertex" onclick="ativarEdicaoVertices()">
                  <i class="fa-solid fa-draw-polygon"></i> Ativar Edição de Vértices
                </button>
                <p class="text-muted small text-center" id="msgVertex" style="display:none;"></p>
              </div>
            </form>
          </div>
          <div class="modal-footer justify-content-between">
            <button type="button" class="btn btn-danger" onclick="deletarQuadraAtual()">Excluir</button>
            <button type="button" class="btn btn-primary" onclick="salvarQuadraAtual()">Salvar</button>
          </div>
        </div>
      </div>
    </div>

    <div class="bottom-nav">
      <div class="nav-item active" onclick="mudarAba('geral')" id="btnAbaGeral"><i class="fa-solid fa-map-location-dot"></i><span>Geral</span></div>
      <div class="nav-item" onclick="mudarAba('poligonos')" id="btnAbaPoligonos"><i class="fa-solid fa-pen-ruler"></i><span>Editor</span></div>
      <div class="nav-item" onclick="mudarAba('detalhe')" id="btnAbaDetalhe"><i class="fa-solid fa-list-check"></i><span>Detalhes</span></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.min.js"></script>

    <?!= include('JS-Mapas'); ?>
    <?!= include('JS-App'); ?>
    
  </body>
</html>